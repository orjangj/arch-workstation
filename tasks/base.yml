---
- name: "base : Ensure base packages are installed"
  become: yes
  community.general.pacman:
    state: present
    name: "{{ item }}"
  with_items:
    - base
    - base-devel
    - linux
    - linux-firmware
    - linux-headers
    - intel-ucode  # Is this necessary?
    - git
    - python3
    - vim
    - bash-completion
  tags: [base]

- name: "base : Ensure networking packages are installed"
  become: yes
  community.general.pacman:
    name: "{{ item }}"
  with_items:
    - networkmanager
    - network-manager-applet
    - avahi
    - openssh
    - bluez
    - bluez-utils
    - dnsmasq  # Needed?
    - wpa_supplicant  # Needed?
  tags: [base]

- name: "base : Ensure audio packages are installed"
  become: yes
  community.general.pacman:
    name: "{{ item }}"
  with_items:
    - pulseaudio
    - sof-firmware
  tags: [base]

- name: "base : Ensure display packages are installed"
  become: yes
  community.general.pacman:
    name: "{{ item }}"
  with_items:
    - brightnessctl
  tags: [base, display]

- name: "base : Ensure video/gpu packages are installed"
  become: yes
  community.general.pacman:
    name: "{{ item }}"
  with_items:
    - mesa
    - mesa-utils
  tags: [base, gpu]

- name: "base : Ensure security packages are installed"
  become: yes
  community.general.pacman:
    name: "{{ item }}"
  with_items:
    - firewalld
  tags: [base, security]

- name: "base : Add {{ ansible_env.USER }} user to selected groups"
  become: yes
  ansible.builtin.user:
    user: "{{Â ansible_env.USER }}"
    groups: "{{ item }}"
    append: yes
  with_items:
    - adm
    - wheel
    - video
  tags: [base]
